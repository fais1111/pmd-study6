rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    match /users/{userId} {
      allow read, write: if request.auth.uid == userId;

      match /attempts/{attemptId} {
        allow read, write: if request.auth.uid == userId;
        allow delete: if request.auth.uid == userId || get(/databases/$(database)/documents/users/$(request.auth.uid)).data.email == "techworldinfo98@gmail.com";
      }
    }

    // This rule allows any authenticated user to query the 'attempts' collection group.
    // This is required for the leaderboard feature to read attempts from all users.
    // The function itself only retrieves non-sensitive data for ranking.
    match /{path=**}/attempts/{attemptId} {
      allow read: if request.auth != null;
    }

    match /study_materials/{document=**} {
      allow read: if request.auth != null;
      allow write: if get(/databases/$(database)/documents/users/$(request.auth.uid)).data.email == "techworldinfo98@gmail.com";
    }

    match /quizzes/{document=**} {
      allow read: if request.auth != null;
      allow write: if get(/databases/$(database)/documents/users/$(request.auth.uid)).data.email == "techworldinfo98@gmail.com";
    }
    
    match /configs/{document=**} {
      allow read: if request.auth != null;
      allow write: if get(/databases/$(database)/documents/users/$(request.auth.uid)).data.email == "techworldinfo98@gmail.com";
    }
  }
}
